# Инструкция по импорту файлов в ProBIM

## Описание функции импорта

Функция импорта позволяет загружать данные сметы из файлов Excel (XLS, XLSX) или CSV с автоматическим распознаванием структуры:
- **Этапы** - группировка работ
- **Виды работ** - основные работы с количеством и единицами измерения
- **Ресурсы** - материалы, оборудование и другие ресурсы для выполнения работ

## Как использовать

### Шаг 1: Открытие функции импорта
1. Откройте проект в ProBIM
2. Выберите блок и смету, в которую хотите импортировать данные
3. На ленте **"Смета"** нажмите кнопку **"Импорт файла"**

### Шаг 2: Выбор типа документа
Выберите один из двух типов документа:

#### Тип 1: Упрощенный
Колонки:
- № - номер позиции
- Тип ресурса - тип (Материал, Работа, Оборудование и т.д.)
- Название - наименование позиции
- Ед.изм - единица измерения
- Кол-во - количество
- Цена - цена за единицу
- Сумма - автоматически рассчитывается

#### Тип 2: С кодом сметной
Колонки:
- № - номер позиции
- Тип ресурса - тип (Материал, Работа, Оборудование и т.д.)
- Код ресурса - код по сметной документации
- Название - наименование позиции
- Ед.изм - единица измерения
- Кол-во - количество
- Цена - цена за единицу
- Сумма - автоматически рассчитывается

### Шаг 3: Загрузка файла
1. Перетащите файл в область загрузки или нажмите "выберите файл"
2. Поддерживаемые форматы: **XLS, XLSX, CSV**
3. Нажмите **"Далее"**

### Шаг 4: Форматирование и проверка
1. Система автоматически распознает структуру данных
2. Проверьте распознанные данные в таблице
3. Удалите ненужные строки, если необходимо (кнопка с корзиной)
4. Проверьте правильность определения типов строк (Этап/Вид работ/Ресурс)
5. Нажмите **"Импортировать"**

### Шаг 5: Импорт
Система импортирует данные с отображением прогресса и логов

## Правила распознавания структуры

### Этапы
Определяются по одному из признаков:
- Объединенные ячейки в строке
- Строки без номера в первой колонке
- Текст в первой колонке

**Пример:**
```
| ЭТАП 1: ФУНДАМЕНТНЫЕ РАБОТЫ |
```

### Виды работ
Определяются по признакам:
- **Целое число** в первой колонке (1, 2, 3, и т.д.)
- Наличие значений в полях "Кол-во" и "Ед.изм"
- Ячейки НЕ объединены

**Пример:**
```
| 1 | Работа | Устройство фундамента | м³ | 150 | 5000 |
```

### Ресурсы
Определяются по признакам:
- Номер начинается с **точки "."** или **запятой ","**
- Дробные номера (1.1, 1.2, 2.1 и т.д.)

**Пример:**
```
| .1 | Материал | Бетон М300 | м³ | 150 | 4500 |
| .2 | Материал | Арматура А500 | т | 12 | 45000 |
```

## Пример структуры файла

### Для типа 1 (Упрощенный):

| № | Тип ресурса | Название | Ед.изм | Кол-во | Цена |
|---|------------|----------|--------|--------|------|
| **ЭТАП 1: ФУНДАМЕНТЫ** | | | | | |
| 1 | Работа | Устройство фундамента | м³ | 150 | 5000 |
| .1 | Материал | Бетон М300 | м³ | 150 | 4500 |
| .2 | Материал | Арматура А500С | т | 12 | 45000 |
| .3 | Работа | Укладка бетона | м³ | 150 | 500 |
| 2 | Работа | Гидроизоляция фундамента | м² | 300 | 450 |
| .1 | Материал | Битумная мастика | кг | 120 | 250 |
| **ЭТАП 2: СТЕНЫ** | | | | | |
| 3 | Работа | Кирпичная кладка | м³ | 80 | 7500 |
| .1 | Материал | Кирпич керамический | тыс.шт | 25 | 18000 |
| .2 | Материал | Раствор цементный | м³ | 20 | 3500 |

### Для типа 2 (С кодом сметной):

| № | Тип ресурса | Код | Название | Ед.изм | Кол-во | Цена |
|---|------------|-----|----------|--------|--------|------|
| **ЭТАП 1: ФУНДАМЕНТЫ** | | | | | | |
| 1 | Работа | ФЕР06-01-001-01 | Устройство фундамента | м³ | 150 | 5000 |
| .1 | Материал | ГЭСН-401-0001 | Бетон М300 | м³ | 150 | 4500 |
| .2 | Материал | ГЭСН-102-0002 | Арматура А500С | т | 12 | 45000 |

## Советы по подготовке файлов

1. **Используйте стандартную структуру** - Этап → Вид работ → Ресурсы
2. **Нумеруйте правильно**:
   - Этапы: без номера или текстом
   - Виды работ: целыми числами (1, 2, 3)
   - Ресурсы: с точкой (.1, .2) или дробью (1.1, 1.2)
3. **Заполняйте обязательные поля**:
   - Название
   - Единица измерения
   - Количество
   - Цена
4. **Проверяйте данные** перед импортом на шаге 2
5. **Удаляйте лишние строки** (заголовки, пустые строки, итоги) на шаге форматирования

## Устранение проблем

### Файл не загружается
- Проверьте формат файла (должен быть XLS, XLSX или CSV)
- Убедитесь, что файл не поврежден
- Попробуйте пересохранить файл в Excel

### Неправильное распознавание типов
- Проверьте нумерацию в первой колонке
- Убедитесь, что этапы не имеют номеров
- Виды работ должны иметь целые номера
- Ресурсы должны начинаться с точки или иметь дробный номер

### Ошибка при импорте
- Проверьте, что все обязательные поля заполнены
- Убедитесь, что выбрана смета для импорта
- Проверьте соединение с сервером

## Примеры файлов

В корневой папке проекта вы можете найти готовые примеры файлов для импорта:
- `example_import_type1_utf8.csv` - пример для типа 1 (упрощенный формат)
- `example_import_type2_utf8.csv` - пример для типа 2 (с кодами ФЕР и ГЭСН)

**Важно:** Файлы сохранены в формате CSV с кодировкой UTF-8 и разделителем табуляция (TSV).

### Структура примеров

Файлы содержат 3 этапа строительства:
1. **ЗЕМЛЯНЫЕ РАБОТЫ** - разработка грунта, планировка, вывоз
2. **ФУНДАМЕНТНЫЕ РАБОТЫ** - песчаная подушка, опалубка, армирование, бетонирование, гидроизоляция
3. **СТЕНЫ И ПЕРЕКРЫТИЯ** - кладка стен, монолитное перекрытие, оконные проемы, утепление

Всего: **12 видов работ** и **40+ ресурсов** с реалистичными ценами и объемами.
