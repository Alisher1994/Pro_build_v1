// ========================================\n// ProBIM - Shared Utility Functions\n// ========================================\n\nconst Utils = {\n    // --- Formatting ---\n\n    /**\n     * Форматирование числа (например, 1 000 000)\n     */\n    formatNumber(num, fractionDigits = 0) {\n        if (num === null || num === undefined) return '0';\n        return Number(num).toLocaleString('ru-RU', {\n            minimumFractionDigits: fractionDigits,\n            maximumFractionDigits: fractionDigits\n        });\n    },\n\n    /**\n     * Форматирование валюты\n     */\n    formatCurrency(amount, currencyCode = 'RUB') {\n        if (amount === null || amount === undefined) amount = 0;\n        let symbol = 'с.';\n        if (currencyCode === 'RUB') symbol = '₽';\n        else if (currencyCode === 'USD') symbol = '$';\n        else if (currencyCode === 'EUR') symbol = '€';\n        \n        return `${this.formatNumber(amount, 2)} ${symbol}`;\n    },\n\n    /**\n     * Форматирование даты (DD.MM.YYYY)\n     */\n    formatDate(dateString) {\n        if (!dateString) return '-';\n        const date = new Date(dateString);\n        if (isNaN(date.getTime())) return '-';\n        return date.toLocaleDateString('ru-RU');\n    },\n\n    // --- UI Helpers ---\n\n    /**\n     * Показать уведомление\n     */\n    showNotification(message, type = 'info') {\n        const container = document.getElementById('notification-container') || this._createNotificationContainer();\n        \n        const notification = document.createElement('div');\n        notification.className = `notification notification-${type}`;\n        \n        let icon = 'info-circle';\n        if (type === 'success') icon = 'check-circle';\n        if (type === 'error') icon = 'exclamation-triangle';\n        if (type === 'warning') icon = 'exclamation-circle';\n\n        notification.innerHTML = `\n            <i class=\"fas fa-${icon}\"></i>\n            <div class=\"notification-content\">${message}</div>\n            <button class=\"notification-close\">&times;</button>\n        `;\n\n        container.appendChild(notification);\n\n        const closeBtn = notification.querySelector('.notification-close');\n        closeBtn.onclick = () => this._hideNotification(notification);\n\n        setTimeout(() => this._hideNotification(notification), 5000);\n    },\n\n    _createNotificationContainer() {\n        const container = document.createElement('div');\n        container.id = 'notification-container';\n        container.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 9999;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        `;\n        document.body.appendChild(container);\n        return container;\n    },\n\n    _hideNotification(notification) {\n        notification.style.animation = 'slideOut 0.3s ease forwards';\n        setTimeout(() => notification.remove(), 300);\n    },\n\n    /**\n     * Универсальное модальное окно (Core)\n     */\n    showModal(title, content, buttons, options = {}) {\n        // Закрыть текущее, если есть\n        this.closeModal();\n\n        const modalHtml = `\n            <div id=\"common-modal-overlay\" class=\"modal-overlay\">\n                <div class=\"modal-container ${options.wide ? 'modal-wide' : ''}\" style=\"${options.width ? `width: ${options.width}` : ''}\">\n                    <div class=\"modal-header\">\n                        <h3>${title}</h3>\n                        <button class=\"modal-close\">&times;</button>\n                    </div>\n                    <div class=\"modal-body\">\n                        ${content}\n                    </div>\n                    <div class=\"modal-footer\">\n                        ${buttons || `<button class=\"btn btn-secondary\" onclick=\"Utils.closeModal()\">Закрыть</button>`}\n                    </div>\n                </div>\n            </div>\n        `;\n\n        document.body.insertAdjacentHTML('beforeend', modalHtml);\n\n        const overlay = document.getElementById('common-modal-overlay');\n        const closeBtn = overlay.querySelector('.modal-close');\n\n        overlay.addEventListener('click', (e) => {\n            if (e.target === overlay) this.closeModal();\n        });\n\n        closeBtn.addEventListener('click', () => this.closeModal());\n\n        // Фокус на первом инпуте\n        setTimeout(() => {\n            overlay.querySelector('input, select, textarea')?.focus();\n        }, 100);\n    },\n\n    closeModal() {\n        const modal = document.getElementById('common-modal-overlay');\n        if (modal) modal.remove();\n    },\n\n    /**\n     * Подтверждение действия\n     */\n    async confirm(title, message, confirmText = 'Да', cancelText = 'Нет') {\n        return new Promise((resolve) => {\n            const buttons = `\n                <button class=\"btn btn-secondary\" id=\"confirm-cancel\">${cancelText}</button>\n                <button class=\"btn btn-primary\" id=\"confirm-ok\">${confirmText}</button>\n            `;\n            this.showModal(title, `<p>${message}</p>`, buttons);\n\n            document.getElementById('confirm-ok').onclick = () => {\n                this.closeModal();\n                resolve(true);\n            };\n            document.getElementById('confirm-cancel').onclick = () => {\n                this.closeModal();\n                resolve(false);\n            };\n        });\n    }\n};\n\n// Экспорт для использования в глобальной области (совместимость с текущими скриптами)\nwindow.Utils = Utils;\n\n// Добавление стилей, если они отсутствуют\nif (!document.getElementById('utils-styles')) {\n    const style = document.createElement('style');\n    style.id = 'utils-styles';\n    style.textContent = `\n        .notification { \n            min-width: 300px; \n            padding: 15px; \n            border-radius: 8px; \n            background: white; \n            box-shadow: 0 4px 12px rgba(0,0,0,0.15); \n            display: flex; \n            align-items: center; \n            gap: 12px; \n            animation: slideIn 0.3s ease forwards; \n        }\n        .notification-success { border-left: 4px solid #28a745; }\n        .notification-error { border-left: 4px solid #dc3545; }\n        .notification-warning { border-left: 4px solid #ffc107; }\n        .notification-info { border-left: 4px solid #17a2b8; }\n        .notification-close { margin-left: auto; background: none; border: none; font-size: 20px; cursor: pointer; color: #999; }\n        \n        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }\n        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }\n    `;\n    document.head.appendChild(style);\n}\n
