# План реализации модуля ГПР (График Производства Работ)

Цель: Создать профессиональный инструмент календарно-сетевого планирования (аналог Primavera P6) внутри веб-приложения, интегрированный со сметными данными.

## Этап 1: Структура данных и Очереди строительства
**Задача:** Подготовить базу данных для хранения графика и реализовать группировку зданий по очередям строительства.

- [ ] **1.1. Обновление схемы БД (`schema.prisma`)**:
    - Добавить поле `constructionPhase` (Очередь строительства) в модель `Project` (или `Block`, если очереди внутри проекта). *Решение: Добавить в Block поле `phase`.*
    - Создать модели для ГПР:
        - `GanttTask` (Задача): поля `text`, `start_date`, `duration`, `progress`, `parent`, `type`.
        - `GanttLink` (Связь): поля `source`, `target`, `type` (0=FS, 1=SS, etc).
- [ ] **1.2. API для Очередей**:
    - Эндпоинты для назначения очереди блоку.
- [ ] **1.3. UI Главной страницы**:
    - Реализовать группировку блоков по очередям (Этап 1, Этап 2 и т.д.).
    - Визуальное отображение порядка строительства (от дальнего к ближнему).

## Этап 2: Генерация графика из сметы
**Задача:** Автоматически создавать структуру графика (WBS) на основе имеющейся сметы.

- [ ] **2.1. Логика конвертации**:
    - Разработать алгоритм, который превращает иерархию `Блок -> Раздел -> Этап -> Работа` в задачи Ганта.
    - Автоматический расчет длительности: `Длительность = Объем / Норма выработки` (пока заложить дефолтную норму).
- [ ] **2.2. API Генерации**:
    - `POST /api/projects/:id/schedule/generate`: Создает/обновляет задачи Ганта на основе актуальной сметы.

## Этап 3: Интерактивная Диаграмма Ганта (Frontend)
**Задача:** Реализовать интерфейс планировщика.

- [ ] **3.1. Подключение библиотеки**:
    - Интеграция DHTMLX Gantt (Standard Edition - бесплатная версия подходит для базовых задач) или аналога.
- [ ] **3.2. Настройка Grid (Таблицы)**:
    - Колонки: WBS, Название, Длительность, Старт, Финиш, % Выполнения, Ресурсы (сводно).
- [ ] **3.3. CRUD операции**:
    - Создание, редактирование, удаление задач и связей через UI.
    - Сохранение изменений на сервер.

## Этап 4: Продвинутое планирование (P6 Style)
**Задача:** Добавить функции профессионального планирования.

- [ ] **4.1. Типы связей**:
    - Реализовать FS, SS, FF, SF.
    - Учет лагов (задержек).
- [ ] **4.2. Критический путь**:
    - Подсветка задач, влияющих на срок сдачи.
- [ ] **4.3. Ресурсы**:
    - Отображение назначенных ресурсов (из сметы) в свойствах задачи.

## Этап 5: План-Фактный анализ
**Задача:** Контроль хода выполнения.

- [ ] **5.1. Базовый план (Baseline)**:
    - Возможность сохранить текущее состояние как "Базовый план".
- [ ] **5.2. Ввод факта**:
    - Ввод процента выполнения или фактических дат.
- [ ] **5.3. Сравнение**:
    - Визуализация отклонений (Plan vs Actual) на диаграмме.
