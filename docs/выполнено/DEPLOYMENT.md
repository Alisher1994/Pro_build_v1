# Руководство по развертыванию ProBIM на Railway

Этот проект настроен для развертывания как монолитное приложение (Backend + Frontend) на платформе Railway.

## Предварительные требования

1. Установленный Git.
2. Аккаунт на [GitHub](https://github.com).
3. Аккаунт на [Railway](https://railway.app).

## Шаг 1: Подготовка Git репозитория

Откройте терминал в папке `ProBIM` (где находится этот файл) и выполните следующие команды:

```bash
# Инициализация репозитория (если еще не сделано)
git init

# Добавление всех файлов
git add .

# Создание первого коммита
git commit -m "Initial commit for Railway deployment"
```

## Шаг 2: Загрузка на GitHub

1. Создайте новый **пустой** репозиторий на GitHub (без README, .gitignore и лицензии).
2. Скопируйте команды для отправки существующего репозитория (обычно они выглядят так):

```bash
git remote add origin https://github.com/ВАШ_ЮЗЕРНЕЙМ/НАЗВАНИЕ_РЕПОЗИТОРИЯ.git
git branch -M main
git push -u origin main
```

## Шаг 3: Настройка Railway

1. Перейдите в [Railway Dashboard](https://railway.app/dashboard).
2. Нажмите **+ New Project** -> **Deploy from GitHub repo**.
3. Выберите ваш репозиторий `ProBIM`.
4. Нажмите **Deploy Now**.

## Шаг 4: Добавление Базы Данных

1. В проекте Railway нажмите **+ New** -> **Database** -> **PostgreSQL**.
2. Подождите, пока база данных создастся.
3. Railway автоматически добавит переменные окружения `DATABASE_URL` и другие.
4. **Важно:** Нам нужно связать переменную `DATABASE_URL` с нашим сервисом приложения.
   - Обычно Railway делает это автоматически, если они в одном проекте.
   - Проверьте вкладку **Variables** вашего сервиса (не базы данных). Если там нет `DATABASE_URL`, добавьте её, скопировав значение из вкладки **Connect** базы данных.

## Шаг 5: Проверка

1. Перейдите во вкладку **Settings** вашего сервиса.
2. Найдите раздел **Networking** и нажмите **Generate Domain**.
3. Откройте полученную ссылку. Вы должны увидеть интерфейс ProBIM.

## Важное примечание по Базе Данных

Проект был переключен на использование **PostgreSQL** (стандарт для Railway).
- Если вы захотите запустить проект локально, вам понадобится установленный PostgreSQL.
- Команда запуска на сервере использует `prisma db push` для автоматической синхронизации схемы базы данных.

## Примечания

- **Frontend**: Статические файлы фронтенда обслуживаются бэкендом. API доступно по пути `/api`.
- **Миграции**: При каждом запуске автоматически выполняются миграции базы данных (`prisma migrate deploy`).
- **Файлы**: Загруженные файлы (IFC) хранятся временно. Для постоянного хранения в продакшене рекомендуется использовать S3 (AWS/MinIO), так как файловая система Railway эфемерна (очищается при перезапуске). Но для тестирования этого достаточно.
