<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∫–æ–ª–∞–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ (Toggle Switches) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-switch input:focus + .toggle-slider {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */
        .form-card input,
        .form-card select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--theme-border);
            border-radius: 12px;
            font-size: 0.95rem;
            background: var(--theme-input-bg);
            color: var(--theme-text-primary);
            transition: all 0.2s ease;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .form-card input:focus,
        .form-card select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-card select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23475569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
            cursor: pointer;
        }

        body.theme-light .form-card input,
        body.theme-light .form-card select {
            background: #ffffff;
            border-color: #e2e8f0;
        }

        body.theme-light .form-card input:focus,
        body.theme-light .form-card select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body>
    {% include '_sidebar.html' %}

    <div class="main-content">
        <div class="page-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 24px;">
            <h1 style="flex: 1; margin: 0;">üè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∫–æ–ª–∞–º–∏</h1>
            <button class="btn-primary" onclick="openAddSchoolModal()" id="addSchoolBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —à–∫–æ–ª—É</button>
        </div>


        <!-- –°–ø–∏—Å–æ–∫ —à–∫–æ–ª -->
        <table class="data-table">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</th>
                    <th>–ê–¥—Ä–µ—Å</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞</th>
                    <th>–§—É–Ω–∫—Ü–∏–∏</th>
                    <th style="text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="schoolsList">
                <tr><td colspan="8" style="text-align: center; padding: 40px; color: var(--theme-text-tertiary);">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∫–æ–ª—ã -->
    <div id="schoolModal" class="modal" style="display: none;">
        <div class="modal-content modern-modal" style="max-width: 750px;">
            <div class="modal-header-fixed">
                <h2 id="modalTitle" style="margin: 0;">–î–æ–±–∞–≤–∏—Ç—å —à–∫–æ–ª—É</h2>
                <div class="modal-header-actions">
                    <button type="button" onclick="closeSchoolModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" onclick="saveSchool()" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div class="modal-body-scrollable">
                <form id="schoolForm" class="modal-form">
                    <input type="hidden" id="schoolId">
                    
                    <div class="form-card">
                        <label class="field-label" for="schoolName">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã *</label>
                        <input type="text" id="schoolName" required>
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="schoolContactPerson">–§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞</label>
                        <input type="text" id="schoolContactPerson" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="schoolAddress">–ê–¥—Ä–µ—Å —à–∫–æ–ª—ã</label>
                        <input type="text" id="schoolAddress">
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="schoolPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="text" id="schoolPhone" placeholder="+998 XX XXX XX XX">
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="schoolStatus">–°—Ç–∞—Ç—É—Å *</label>
                        <select id="schoolStatus" required>
                            <option value="true">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="false">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                        </select>
                    </div>

                    <div class="form-card" id="adminUsernameCard">
                        <label class="field-label" for="adminUsername">–õ–æ–≥–∏–Ω –≤–ª–∞–¥–µ–ª—å—Ü–∞ —à–∫–æ–ª—ã *</label>
                        <input type="text" id="adminUsername" required>
                    </div>

                    <div class="form-card" id="adminPasswordCard">
                        <label class="field-label" for="adminPassword">–ü–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —à–∫–æ–ª—ã *</label>
                        <input type="password" id="adminPassword" required>
                        <small class="field-hint" id="passwordHint" style="display: none;">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å</small>
                    </div>

                    <div class="form-card">
                        <label class="field-label" style="margin-bottom: 16px;">–§—É–Ω–∫—Ü–∏–∏</label>
                        <div id="featuresList" style="display: grid; gap: 10px;">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        console.log('[Schools] Page template loaded');
        {% if not (current_user is defined and (current_user.__class__.__name__ == 'SuperAdmin' or getattr(current_user, 'role', None) == 'super_admin')) %}
        console.error('[Schools] ERROR: User is not super_admin!');
        alert('–û—à–∏–±–∫–∞: –í—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.');
        window.location.href = '/dashboard';
        {% else %}
        console.log('[Schools] User is super_admin, page should load correctly');
        {% endif %}
    </script>
    <script src="{{ url_for('static', filename='js/schools.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</body>
</html>

