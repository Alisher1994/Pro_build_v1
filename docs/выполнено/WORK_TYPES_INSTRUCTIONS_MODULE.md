# Модуль "Инструкции и виды работ"

## Описание

Модуль предназначен для управления справочниками видов работ и инструкций по охране труда. Доступ к модулю осуществляется через **Настройки > Инструкции и виды работ**.

## Структура модуля

Модуль состоит из двух основных разделов:

### 1. Справочник "Виды работ"

Иерархическая структура для классификации строительных работ.

#### Интерфейс

- **Левая панель**: Список групп работ
  - Кнопка "Добавить группу" - создание новой группы
  - Для каждой группы доступны кнопки "Изменить" и "Удалить"

- **Правая панель**: Список видов работ выбранной группы
  - Кнопка "Добавить вид работ" (активна только при выбранной группе)
  - Для каждого вида работ доступны кнопки "Изменить" и "Удалить"

#### Поля для "Вида работ"

1. **Наименование вида работ** (обязательное) - название работы
2. **Единица измерения** (обязательное) - выбор из списка:
   - м (метры)
   - м² (квадратные метры)
   - м³ (кубические метры)
   - шт (штуки)
   - т (тонны)
   - км (километры)
   - л (литры)
   - комплект
   - маш.-ч (машино-часы)
   - чел.-ч (человеко-часы)

#### Функциональность

- **Создание группы**: Введите название и нажмите "Сохранить"
- **Редактирование группы**: Нажмите "Изменить" рядом с названием группы
- **Удаление группы**: Возможно только если группа не содержит видов работ
- **Создание вида работ**: Выберите группу, нажмите "Добавить вид работ", заполните поля
- **Редактирование вида работ**: Нажмите "Изменить" рядом с видом работ
- **Удаление вида работ**: Возможно только если вид работ не используется в инструкциях

### 2. Модуль "Инструкции"

Реестр инструкций по охране труда с привязкой к видам работ.

#### Интерфейс

Таблица инструкций со столбцами:
- **Код** - идентификатор инструкции
- **Название** - полное название инструкции
- **Виды работ** - привязанные виды работ
- **Действия** - кнопки "Изменить" и "Удалить"

Кнопка "Добавить инструкцию" в верхней части страницы открывает модальное окно.

#### Поля модального окна

1. **Код** (обязательное) - уникальный идентификатор инструкции
2. **Название** (обязательное) - полное название инструкции
3. **Привязка к видам работ** - множественный выбор из справочника:
   - Виды работ сгруппированы по группам
   - Названия групп выделены цветом #c1d8d7
   - Checkbox для каждого вида работ
   - Можно выбрать несколько видов работ
4. **Текст инструкции** (обязательное) - максимум 20 000 символов
   - Счетчик символов в реальном времени

#### Функциональность

- **Создание инструкции**: Нажмите "Добавить инструкцию", заполните все поля, выберите виды работ
- **Редактирование инструкции**: Нажмите "Изменить" в строке инструкции
- **Удаление инструкции**: Нажмите "Удалить" и подтвердите действие
- **Привязка видов работ**: В модальном окне отметьте нужные виды работ (можно выбрать несколько)

## API Endpoints

### Группы работ

- `GET /api/work-type-groups` - получить все группы с видами работ
- `GET /api/work-type-groups/:id` - получить группу по ID
- `POST /api/work-type-groups` - создать группу
- `PUT /api/work-type-groups/:id` - обновить группу
- `DELETE /api/work-type-groups/:id` - удалить группу

### Виды работ

- `GET /api/work-type-groups/:groupId/items` - получить виды работ группы
- `POST /api/work-type-groups/:groupId/items` - создать вид работ
- `PUT /api/work-type-groups/:groupId/items/:itemId` - обновить вид работ
- `DELETE /api/work-type-groups/:groupId/items/:itemId` - удалить вид работ

### Инструкции

- `GET /api/instructions` - получить все инструкции
- `GET /api/instructions/:id` - получить инструкцию по ID
- `POST /api/instructions` - создать инструкцию
- `PUT /api/instructions/:id` - обновить инструкцию
- `DELETE /api/instructions/:id` - удалить инструкцию

## База данных

### Таблицы

1. **WorkTypeGroup** - группы работ
   - id (UUID)
   - name (String)
   - orderIndex (Int)
   - createdAt, updatedAt (DateTime)

2. **WorkTypeItem** - виды работ
   - id (UUID)
   - groupId (UUID) - связь с группой
   - name (String)
   - unit (String)
   - orderIndex (Int)
   - createdAt, updatedAt (DateTime)

3. **Instruction** - инструкции
   - id (UUID)
   - code (String)
   - name (String)
   - text (String) - до 20 000 символов
   - createdAt, updatedAt (DateTime)

4. **InstructionWorkType** - связь инструкций и видов работ (many-to-many)
   - id (UUID)
   - instructionId (UUID)
   - workTypeItemId (UUID)

## Файлы проекта

### Backend

- `backend/prisma/schema.prisma` - схема базы данных
- `backend/src/routes/workTypeGroups.ts` - API для групп и видов работ
- `backend/src/routes/instructions.ts` - API для инструкций
- `backend/src/server.ts` - регистрация routes

### Frontend

- `frontend/js/workTypeGroups.js` - UI для справочника видов работ
- `frontend/js/instructionsManager.js` - UI для инструкций
- `frontend/js/settings.js` - обновлен для отображения меню выбора
- `frontend/index.html` - подключение JS файлов

## Примечания

- Модуль НЕ связан с видами работ в сметах (EstimateStage)
- Это отдельный справочник для настроек проекта
- Группы и виды работ используются только для организации инструкций
- При удалении группы проверяется наличие видов работ
- При удалении вида работ проверяется использование в инструкциях
